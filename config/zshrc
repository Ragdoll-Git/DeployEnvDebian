# ==============================================================================
# CONFIGURACION ZSH - PERSONALIZADA
# ==============================================================================

# Ruta de Oh My Zsh
export ZSH="$HOME/.oh-my-zsh"

# Tema (puedes cambiarlo si usas Starship, este es el fallback)
ZSH_THEME="robbyrussell"

# Plugins
plugins=(git)

source $ZSH/oh-my-zsh.sh

# ==============================================================================
# ALIAS Y HERRAMIENTAS MODERNAS
# ==============================================================================

# Reemplazos modernos (ls -> eza, cat -> bat)
alias ls="eza --icons --group-directories-first"
alias ll="eza -al --icons --group-directories-first"
alias cat="batcat"  # Nota: En Debian es batcat, el script de python ya hizo el symlink a 'bat' pero esto asegura compatibilidad

# Zoxide (Reemplazo de cd)
if command -v zoxide > /dev/null; then
    eval "$(zoxide init zsh)"
    alias cd="z"
fi

# Starship (Prompt)
if command -v starship > /dev/null; then
    eval "$(starship init zsh)"
fi

# Tema para Bat
export BAT_THEME="Catppuccin Mocha"

# Clave de API de Gemini (El instalador de Python la inyectara aqui si se configura)
# export GEMINI_API_KEY="tu_clave_aqui"

# ==============================================================================
# FUNCIONES DE IA (Ollama + Gemini)
# ==============================================================================

# Funciones de limpieza (Helpers)
clean_think() { sed '/<think>/,/<\/think>/d'; }
clean_empty() { sed '/^$/d'; }

# --- QWEN (Local - Rapido) ---
# Uso: qwen: "pregunta" o solo qwen:
qwen:() {
    if [ -n "$1" ]; then
        # Modo comando: Ejecuta y limpia el "pensamiento"
        ollama run qwen-local "$*" | clean_think
    else
        # Modo chat interactivo
        ollama run qwen-local
    fi
}

# --- GEMMA (Local - Balanceado) ---
# Uso: gemma: "pregunta" o solo gemma:
gemma:() {
    if [ -n "$1" ]; then
        ollama run gemma-local "$*" | clean_empty
    else
        ollama run gemma-local
    fi
}

# --- PHI (Local - Logica) ---
# Uso: phi: "pregunta" o solo phi:
phi:() {
    if [ -n "$1" ]; then
        ollama run phi-local "$*" | clean_empty
    else
        ollama run phi-local
    fi
}

# --- GEMINI (Nube - Respaldo) ---
# Uso: gemini: "pregunta" o solo gemini:
gemini:() {
    SCRIPT_PATH="$HOME/.gemini-cli/gemini_tool.py"
    VENV_PYTHON="$HOME/.gemini-cli/venv/bin/python"
    
    if [ ! -f "$SCRIPT_PATH" ]; then
        echo "[Error] Gemini no esta configurado. Ejecuta el instalador nuevamente."
        return 1
    fi

    if [ -n "$1" ]; then
        # Modo pregunta directa
        "$VENV_PYTHON" "$SCRIPT_PATH" "$*"
    else
        # Modo chat (Simulado: Gemini API es stateless por defecto, 
        # aqui solo pedimos input si el script python soporta loop, 
        # o simplemente avisamos al usuario)
        echo "Escribe tu pregunta para Gemini:"
        read -r PREGUNTA
        "$VENV_PYTHON" "$SCRIPT_PATH" "$PREGUNTA"
    fi
}