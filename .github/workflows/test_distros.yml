name: Test Multi-Distro Support

on:
  # 1. Ejecución automática al subir código
  push:
    branches: [ "main" ]
  pull_request:
    branches: [ "main" ]
  
  # 2. Ejecución manual desde la web de GitHub
  workflow_dispatch:
    inputs:
      log_theme:
        description: 'Color del tema para los logs'
        required: true
        default: 'blue'
        type: choice
        options:
        - blue
        - green
        - red
        - magenta

jobs:
  # ------------------------------------------------------------------
  # JOB 1: DEBIAN (APT)
  # ------------------------------------------------------------------
  test-debian:
    name: Test on Debian Bookworm
    runs-on: ubuntu-latest
    container: debian:bookworm-slim
    steps:
      - name: Checkout Code
        uses: actions/checkout@v4

      - name: Install Dependencies (Pre-requisitos)
        # Instalamos sudo y python porque la imagen raw no los trae
        run: |
          apt-get update
          apt-get install -y python3 sudo git curl

      - name: Run Deploy Script
        # Usamos "|| 'blue'" como fallback por si se ejecuta automáticamente (push)
        run: python3 main.py --packages --theme ${{ inputs.log_theme || 'blue' }}

  # ------------------------------------------------------------------
  # JOB 2: ALPINE (APK)
  # ------------------------------------------------------------------
  test-alpine:
    name: Test on Alpine Linux
    runs-on: ubuntu-latest
    container: alpine:latest
    steps:
      - name: Checkout Code
        uses: actions/checkout@v4

      - name: Install Dependencies
        # Alpine necesita bash a veces para ciertos scripts internos de setup
        run: |
          apk update
          apk add python3 sudo git bash curl

      - name: Run Deploy Script
        run: python3 main.py --packages --theme ${{ inputs.log_theme || 'green' }}

  # ------------------------------------------------------------------
  # JOB 3: FEDORA (DNF)
  # ------------------------------------------------------------------
  test-fedora:
    name: Test on Fedora
    runs-on: ubuntu-latest
    container: fedora:latest
    steps:
      - name: Checkout Code
        uses: actions/checkout@v4

      - name: Install Dependencies
        run: |
          dnf install -y python3 sudo git curl

      - name: Run Deploy Script
        run: python3 main.py --packages --theme ${{ inputs.log_theme || 'red' }}